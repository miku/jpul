(function(){_.Events=window.Backbone?Backbone.Events:{bind:function(b,d){var a=this._callbacks||(this._callbacks={});var c=this._callbacks[b]||(this._callbacks[b]=[]);c.push(d);return this},unbind:function(d,f){var c;if(!d){this._callbacks={}}else{if(c=this._callbacks){if(!f){c[d]=[]}else{var e=c[d];if(!e){return this}for(var b=0,a=e.length;b<a;b++){if(f===e[b]){e.splice(b,1);break}}}}}return this},trigger:function(d){var e,c,b,a;if(!(c=this._callbacks)){return this}if(e=c[d]){for(b=0,a=e.length;b<a;b++){e[b].apply(this,Array.prototype.slice.call(arguments,1))}}if(e=c.all){for(b=0,a=e.length;b<a;b++){e[b].apply(this,arguments)}}return this}};Sanitize.Config={};Sanitize.Config.BASIC={elements:["a","b","br","em","i","li","ol","p","strong","code","ul","div"],attributes:{a:["href"],},protocols:{a:{href:["ftp","http","https","mailto",Sanitize.RELATIVE]}}};controlsTpl='     <div class="proper-commands">       <a href="#" title="Kursiv" class="command em" command="em"><div>Emphasis</div></a>       <a href="#" title="Fett" class="command strong" command="strong"><div>Strong</div></a>       <a href="#" title="Liste" class="command ul" command="ul"><div>Bullets List</div></a>       <a title="Link" href="#" class="command link" command="link"><div>Link</div></a>     </div>   ';this.Proper=function(j){var b=null,h,i={},f=this,e=false;$("body").append($('<div id="proper_content"></div>').hide());var a={execEM:function(){document.execCommand("italic",false,true);return false},execSTRONG:function(){document.execCommand("bold",false,true);return false},execCODE:function(){document.execCommand("insertHTML",false,"<code>"+window.getSelection()+"</code>");return false},execUL:function(){document.execCommand("insertUnorderedList",false,null);return false},execOL:function(){document.execCommand("insertOrderedList",false,null);return false},execINDENT:function(){document.execCommand("indent",false,null);return false},execOUTDENT:function(){document.execCommand("outdent",false,null);return false},execLINK:function(){document.execCommand("createLink",false,prompt("URL:"));return false},showHTML:function(){alert($(this.el).html())}};function c(k){var l=new Sanitize(Sanitize.Config.BASIC);var m=l.clean_node(k);$("#proper_content").html(m)}function g(k){$(k).find("b").each(function(){$(this).replaceWith($("<strong>").html($(this).html()))});$(k).find("i").each(function(){$(this).replaceWith($("<em>").html($(this).html()))})}function d(k){$(k).bind("paste",function(){setTimeout(function(){c($(k)[0]);$(k).html($("#proper_content").html())},10)});$(k).bind("keyup",function(l){setTimeout(function(){if(!e){e=true;setTimeout(function(){e=false;c($(b)[0]);g($("#proper_content")[0]);if(l.keyCode==13){$($(b)[0]).append("<br>")}i.trigger("changed")},200)}},10);return true})}i.deactivate=function(){$(b).attr("contenteditable","false");$(b).unbind("paste");$controls.hide();i.unbind("changed")};i.activate=function(k){if(k!==b){i.deactivate();$(k).attr("contenteditable",true);b=k;d(k);$("#proper_content").html($(k).html());$controls.insertBefore(k);$controls.show()}};i.content=function(){return b?$("#proper_content").html():""};$controls=$(controlsTpl),$controls.prependTo($("body")).hide();$(".proper-commands a.command").click(function(k){a["exec"+$(k.currentTarget).attr("command").toUpperCase()]();setTimeout(function(){c($(b)[0]);g($("#proper_content")[0]);i.trigger("changed")},10);return false});_.extend(i,_.Events);return i}})();