function Sanitize(){var b,c,a;a=arguments[0]||{};this.config={};this.config.elements=a.elements?a.elements:[];this.config.attributes=a.attributes?a.attributes:{};this.config.attributes[Sanitize.ALL]=this.config.attributes[Sanitize.ALL]?this.config.attributes[Sanitize.ALL]:[];this.config.allow_comments=a.allow_comments?a.allow_comments:false;this.allowed_elements={};this.config.protocols=a.protocols?a.protocols:{};this.config.add_attributes=a.add_attributes?a.add_attributes:{};this.dom=a.dom?a.dom:document;for(b=0;b<this.config.elements.length;b++){this.allowed_elements[this.config.elements[b]]=true}this.config.remove_element_contents={};this.config.remove_all_contents=false;if(a.remove_contents){if(a.remove_contents instanceof Array){for(b=0;b<a.remove_contents.length;b++){this.config.remove_element_contents[a.remove_contents[b]]=true}}else{this.config.remove_all_contents=true}}this.transformers=a.transformers?a.transformers:[]}Sanitize.REGEX_PROTOCOL=/^([A-Za-z0-9\+\-\.\&\;\*\s]*?)(?:\:|&*0*58|&*x0*3a)/i;Sanitize.RELATIVE="__relative__";Sanitize.prototype.clean_node=function(c){var d=this.dom.createDocumentFragment();this.current_element=d;this.whitelist_nodes=[];function g(k,j){var h;for(h=0;h<j.length;h++){if(j[h]==k){return h}}return -1}function b(){var h=[];var m={};var l,k;for(l=0;l<arguments.length;l++){if(!arguments[l]||!arguments[l].length){continue}for(k=0;k<arguments[l].length;k++){if(m[arguments[l][k]]){continue}m[arguments[l][k]]=true;h.push(arguments[l][k])}}return h}function f(h){var j;switch(h.nodeType){case 1:e.call(this,h);break;case 3:var j=h.cloneNode(false);this.current_element.appendChild(j);break;case 5:var j=h.cloneNode(false);this.current_element.appendChild(j);break;case 8:if(this.config.allow_comments){var j=h.cloneNode(false);this.current_element.appendChild(j)}default:}}function e(n){var p,o,r,v,h,m,q,w,k,t,u,s;var l=a.call(this,n);n=l.node;h=n.nodeName.toLowerCase();v=this.current_element;if(this.allowed_elements[h]||l.whitelist){this.current_element=this.dom.createElement(n.nodeName);v.appendChild(this.current_element);m=b(this.config.attributes[h],this.config.attributes.__ALL__,l.attr_whitelist);for(p=0;p<m.length;p++){w=m[p];q=n.attributes[w];if(q){s=true;if(this.config.protocols[h]&&this.config.protocols[h][w]){t=this.config.protocols[h][w];u=q.nodeValue.toLowerCase().match(Sanitize.REGEX_PROTOCOL);if(u){s=(g(u[1],t)!=-1)}else{s=(g(Sanitize.RELATIVE,t)!=-1)}}if(s){k=document.createAttribute(w);k.value=q.nodeValue;this.current_element.setAttributeNode(k)}}}if(this.config.add_attributes[h]){for(w in this.config.add_attributes[h]){k=document.createAttribute(w);k.value=this.config.add_attributes[h][w];this.current_element.setAttributeNode(k)}}}else{if(g(n,this.whitelist_nodes)!=-1){this.current_element=n.cloneNode(true);while(this.current_element.childNodes.length>0){this.current_element.removeChild(this.current_element.firstChild)}v.appendChild(this.current_element)}}if(!this.config.remove_all_contents&&!this.config.remove_element_contents[h]){for(p=0;p<n.childNodes.length;p++){f.call(this,n.childNodes[p])}}if(this.current_element.normalize){this.current_element.normalize()}this.current_element=v}function a(n){var h={attr_whitelist:[],node:n,whitelist:false};var m,l,k;for(m=0;m<this.transformers.length;m++){k=this.transformers[m]({allowed_elements:this.allowed_elements,config:this.config,node:n,node_name:n.nodeName.toLowerCase(),whitelist_nodes:this.whitelist_nodes,dom:this.dom});if(k==null){continue}else{if(typeof k=="object"){if(k.whitelist_nodes&&k.whitelist_nodes instanceof Array){for(l=0;l<k.whitelist_nodes.length;l++){if(g(k.whitelist_nodes[l],this.whitelist_nodes)==-1){this.whitelist_nodes.push(k.whitelist_nodes[l])}}}h.whitelist=k.whitelist?true:false;if(k.attr_whitelist){h.attr_whitelist=b(h.attr_whitelist,k.attr_whitelist)}h.node=k.node?k.node:h.node}else{throw new Error("transformer output must be an object or null")}}}return h}for(i=0;i<c.childNodes.length;i++){f.call(this,c.childNodes[i])}if(d.normalize){d.normalize()}return d};